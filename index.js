const qrcode = require ('qrcode-terminal');
const { Client, LocalAuth, MessageMedia, MessageTypes, List, Buttons } = require ('whatsapp-web.js');
const client = new Client ({
    authStrategy: new LocalAuth()
});
client.on('qr', qr => {
    qrcode.generate(qr, {small: true});
});

client.on('ready', () => {
    console.log('Conectado com sucesso!');
});

client.initialize();


function saudacao() {
    const data = new Date();
    let hora = data.getHours();
    let str = '';
    if (hora >= 8 && hora < 15) {
        str = 'Bom dia ';
    } else if (hora >= 15 && hora < 21) {
        str = 'Boa tarde ';
    } else {
        str = 'Boa noite ';
    }
    return str;
};
function atendente() {
    const data = new Date();
    let hora = data.getHours();
    let dia = data.getDay();
    let strdois = '';
    if (dia === 6 && hora >= 12 && hora < 17) {
        strdois = 'ğŸ˜ƒ Aguarde um momento que logo serÃ¡ atendido.';
    }
    else if (dia < 6 && dia > 0 && hora >= 12 && hora < 22) {
        strdois = 'ğŸ˜ƒ Aguarde um momento que logo serÃ¡ atendido.';
    } else {
        strdois = 'Humm... \nğŸ˜Œ JÃ¡ estamos fora do horÃ¡rio de atendimento.\n\nğŸ˜ƒ Mas nÃ£o se preocupe, retornaremos assim que possÃ­vel!\n\nğŸ•˜ _Nosso horÃ¡rio Ã© de segunda a sexta de 09:00hs Ã s 19:00hs e sÃ¡bado de 09:00hs Ã s 14:00hs._\n\n*Atendimento presencial mediante agendamento.*';
        }
    return strdois;
};

const hash = "#";
const zero = "0";
function domingo() {
    const data = new Date();
    let dia = data.getDay();
    let hora = data.getHours();
    let strtres = '';
    if (dia === 0) {
        strtres = 'ğŸ–ï¸ *Aproveite o fim de semana!*\n\nğŸ˜ƒ Entraremos em contato assim que possÃ­vel.\n\nğŸ•˜ _Nosso horÃ¡rio Ã© de segunda a sexta de 09:00hs Ã s 19:00hs e sÃ¡bado de 09:00hs Ã s 14:00hs._\n\n*Atendimento presencial mediante agendamento.*';
    } else if (dia === 6 && hora >= 17) {
        strtres = 'ğŸ–ï¸ *Aproveite o fim de semana!*\n\nğŸ˜ƒ Entraremos em contato assim que possÃ­vel.\n\nğŸ•˜ _Nosso horÃ¡rio Ã© de segunda a sexta de 09:00hs Ã s 19:00hs e sÃ¡bado de 09:00hs Ã s 14:00hs._\n\n*Atendimento presencial mediante agendamento.*';
    }
    
    else {
        strtres = atendente();
        }
    return strtres;
    };
    
const delay = (ms) => new Promise((res) => setTimeout(res, ms));
client.on('message', async (msg) => {
    
    if (msg.body.match (/(Oi|Bom Dia|Boa tarde)/i) && msg.from.endsWith('@c.us'))  {
        const chat = await msg.getChat();
        const contact = await msg.getContact();
        const name = contact.pushname;                            
              
            await delay(3000);
            await chat.sendStateTyping();
            await delay(3000);
            await client.sendMessage(msg.from, saudacao() + name.split(" ")[0] + '!\nğŸ™‹â€â™‚ï¸ Sou o *Rodrigo,* assistente virtual da *Casa Perfeita Planejados!*\n_Como posso ajudar?_\n\nPor favor digite o *NÃšMERO* de uma das opÃ§Ãµes abaixo. ğŸ‘‡\n\n1ï¸âƒ£ - Realizar projeto\n2ï¸âƒ£ - CatÃ¡logo\n3ï¸âƒ£ - AssistÃªncia tÃ©cnica\n4ï¸âƒ£ - Acompanhar entrega\n5ï¸âƒ£ - Outros assuntos');


    

    };
    if (msg.body.match (/OlÃ¡! Gostaria de mais informaÃ§Ãµes/i) && msg.from.endsWith ('@c.us'))  {
        const chat = await msg.getChat();
        const contact = await msg.getContact();
        const name = contact.pushname;                            
              
            await delay(3000);
            await chat.sendStateTyping();
            await delay(3000);
            await client.sendMessage(msg.from, saudacao() + name.split(" ")[0] + '!\nğŸ™‹â€â™‚ï¸ Sou o *Rodrigo,* assistente virtual da *Casa Perfeita Planejados!*\n_Como posso ajudar?_\n\nPor favor digite o *NÃšMERO* de uma das opÃ§Ãµes abaixo. ğŸ‘‡\n\n1ï¸âƒ£ - Realizar projeto\n2ï¸âƒ£ - CatÃ¡logo\n3ï¸âƒ£ - AssistÃªncia tÃ©cnica\n4ï¸âƒ£ - Acompanhar entrega\n5ï¸âƒ£ - Outros assuntos');


    

    }
           else if (msg.body === "1") { 
                const chat = await msg.getChat();
                await delay(3000);
                await chat.sendStateTyping();
                await delay(3000);
                await client.sendMessage(msg.from, 'ğŸ˜ƒ *Maravilha!*\n\nâ¡ï¸ Ã‰ sua primeira experiÃªncia em compra de planejados?\n\n#ï¸âƒ£ - *SIM*\n0ï¸âƒ£ - *NÃƒO*');
                
                }  else if (msg.body === hash) {
                    const chat = await msg.getChat();
                    await delay(3000);
                    await chat.sendStateTyping();
                    await delay(3000);
                    await client.sendMessage(msg.from, 'ğŸ˜ƒ *Tudo bem, iremos te ajudar*\n\nVou pedir que preencha o nosso formulÃ¡rio de *briefing abaixo* para entender melhor o seu projeto. ğŸ‘‡\n\nhttps://casaperfeitaplanejados.com.br/?page_id=639');
                    await delay(3000);
                    await chat.sendStateTyping();
                    await delay(3000);
                    await client.sendMessage(msg.from, 'â¡ï¸ Ã‰ muito *importante* preencher todos os campos do formulÃ¡rio para nossa equipe conseguir desenvolver um projeto perfeito para vocÃª.');
                    await delay(3000);
                    await chat.sendStateTyping();
                    await delay (3000);
                    await client.sendMessage(msg.from, 'ğŸ‘‹ *AtÃ© logo!*');
                    
                }; if (msg.body.match (/Venho atravÃ©s do site, /i)) {
                    const chat = await msg.getChat();
                    const contact = await msg.getContact();
                    const name = contact.pushname;
                    const audio = MessageMedia.fromFilePath('./audio_carol.mp3');
                    await delay(3000);
                    await chat.sendStateTyping();
                    await delay(3000);
                    await client.sendMessage(msg.from, 'ğŸ˜ƒ Maravilha ' + name.split(' ')[0] + '!\n\nAgora que preencheu nosso formulÃ¡rio, irei encaminhar um Ã¡udio para te explicar como funciona o nosso trabalho.');
                    await delay (3000);
                    await chat.sendStateRecording();
                    await delay (5000);
                    await client.sendMessage(msg.from, audio, {sendAudioAsVoice:true});
                    await delay(3000);
                    await chat.sendStateTyping();
                    await delay(3000);
                    await client.sendMessage(msg.from, 'VocÃª possui a planta ou imagens do ambiente?\n\nCaso possua, irei aguardar um pouquinho, para que procure e envie para nÃ³s. ğŸ˜‰\n\n8ï¸âƒ£ - SIM\n9ï¸âƒ£ - NÃƒO');
                
                }; if (msg.body === zero) {
                    const chat = await msg.getChat();
                    await delay(3000);
                    await chat.sendStateTyping();
                    await delay(3000);
                    await client.sendMessage(msg.from, 'ğŸ˜ƒ *Perfeito!*\n\nVou pedir que preencha o nosso formulÃ¡rio de *briefing abaixo* para entender melhor o seu projeto. ğŸ‘‡\n\nhttps://casaperfeitaplanejados.com.br/?page_id=639');
                    await delay(3000);
                    await chat.sendStateTyping();
                    await delay(3000);
                    await client.sendMessage(msg.from, 'â¡ï¸ Ã‰ muito *importante* preencher todos os campos do formulÃ¡rio para nossa equipe conseguir desenvolver um projeto perfeito para vocÃª.');
                    await delay(3000);
                    await chat.sendStateTyping();
                    await delay (3000);
                    await client.sendMessage(msg.from, 'ğŸ‘‹ *AtÃ© logo!*');

               

            } else if (msg.body === "8") {
                    const chat = await msg.getChat();
                await delay(3000);
                await chat.sendStateTyping();
                await delay(3000);
                await client.sendMessage(msg.from, 'ğŸ˜‰ *Perfeito!*\n\nVou aguardar um minuto para que envie os arquivos.');
                await delay(60000);
                await chat.sendStateTyping();
                await delay(3000);
                await client.sendMessage(msg.from, 'ğŸ˜ƒ *Excelente!*\n\nAgora vou chamar o *atendente* para dar continuidade nesta conversa');
                await delay(3000);
                await chat.sendStateTyping();
                await client.sendMessage(msg.from, 'Vou encaminhar o link do nosso instagram abaixo enquanto aguarda o seu atendimento. ğŸ‘‡\n\nhttps://www.instagram.com/casaperfeitaplanejados?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw==');
                await delay(3000);
                await chat.sendStateTyping();
                await delay(3000);
                await client.sendMessage(msg.from, domingo());
            
            }else if (msg.body === "9") {
                const chat = await msg.getChat();
                await delay(3000);
                await chat.sendStateTyping();
                await delay(3000);
                await client.sendMessage(msg.from, 'ğŸ˜‰ NÃ£o tem problema, vou direcionar vocÃª para um de nossos atendentes.');
                await delay(3000);
                await chat.sendStateTyping();
                await client.sendMessage(msg.from, 'Vou encaminhar o link do nosso instagram abaixo enquanto aguarda o seu atendimento. ğŸ‘‡\n\nhttps://www.instagram.com/casaperfeitaplanejados?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw==');
                await delay(3000);
                await chat.sendStateTyping();
                await delay(3000);
                await client.sendMessage(msg.from, domingo());          
            
            
            
            
            }else if (msg.body === "2") {
                const chat = await msg.getChat();
                const catalogo = MessageMedia.fromFilePath('./catalogo_de_cores_casa_perfeita.pdf')
                await delay(3000);
                await chat.sendStateTyping();
                await delay(3000);
                await client.sendMessage(msg.from, 'ğŸ˜ƒ *Excelente escolha!*\n\nVocÃª vai se encantar com nossos catÃ¡logos incrÃ­veis!\n\n_Irei encaminhar para vocÃª._');
                await delay(3000);
                await chat.sendStateTyping();
                await delay(3000);
                await client.sendMessage(msg.from, 'Este aqui Ã© o nosso catÃ¡logo de cores e acabamentos para vocÃª se encantar com nossas novidades. ğŸ‘‡');
                await delay(3000);
                await client.sendMessage(msg.from, catalogo, {sendMediaAsDocument: true});
                await delay(3000);
                await chat.sendStateTyping();
                await delay(3000);
                await client.sendMessage(msg.from, 'Vou encaminhar o link do nosso instagram.\nLÃ¡ vocÃª tambÃ©m encontra Ã³timas idÃ©ias para o seu projeto alÃ©m de acompanhar o nosso incrÃ­vel trabalho.\n\nBasta acessar o link abaixo. ğŸ‘‡\n\nhttps://www.instagram.com/casaperfeitaplanejados?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw==');
                await delay(3000);
                await chat.sendStateTyping();
                await delay(3000);
                await client.sendMessage(msg.from, 'Se quiser retornar ao menu principal, Ã© sÃ³ digitar a palavra *Oi* para reiniciar seu atendimento.\n\nğŸ‘‹ *AtÃ© logo!*');

            } else if (msg.body === "3") {
                const chat = await msg.getChat();
                
                await delay(3000);
                await chat.sendStateTyping();
                await delay(3000);
                await client.sendMessage(msg.from, 'ğŸ˜‰ Entendi, vocÃª precisa de assistÃªncia tÃ©cnica.\n\nPara isso irei pedir algumas informaÃ§Ãµes que irÃ£o agilizar o seu atendimento. Ok?');
                await delay(3000);
                await chat.sendStateTyping();
                await delay(3000);
                await client.sendMessage(msg.from, 'Informe o seu nome completo ou nÃºmero do contrato por favor:');
                await delay(30000);
                await chat.sendStateTyping();
                await delay(3000);
                await client.sendMessage(msg.from, 'Vou pedir para que nos envie um Ã¡udio relatando o problema, se puder encaminhar um vÃ­deo ou fotos tambÃ©m irÃ¡ ajudar.');
                await delay(60000);
                await chat.sendStateTyping();
                await delay(3000);
                await client.sendMessage(msg.from, domingo());




            } else if (msg.body === "4") {
                const chat = await msg.getChat();
                await delay(3000);
                await chat.sendStateTyping();
                await delay(3000);
                await client.sendMessage(msg.from, 'ğŸ˜ƒ *Que bom ter vocÃª como nosso cliente!*\n_Seu sonho estÃ¡ cada vez mais perto de ser realizado!_\n\nInforme o nÃºmero do seu contrato ou nome completo por favor?');
                await delay(30000);
                await chat.sendStateTyping();
                await delay(3000);
                await client.sendMessage(msg.from, 'Vou encaminhar seu atendimento para um de nossos atendentes para dar seguimento em sua solicitaÃ§Ã£o.');
                await delay(3000);
                await chat.sendStateTyping();
                await delay(3000);
                await client.sendMessage(msg.from, domingo());
                                   

                        
                    } else if(msg.body === "5") {
                        const chat = await msg.getChat();
                        await delay(3000);
                        await chat.sendStateTyping();
                        await delay(3000);
                        await client.sendMessage(msg.from, 'ğŸ˜‰ *Certo, vamos falar sobre outros assuntos*\n\nVou te encaminhar para um de nossos atendentes e enquanto isso, fique a vontade para descrever o que precisa.');
                        await delay(3000);
                        await chat.sendStateTyping();
                        await delay(3000);
                        await client.sendMessage(msg.from, domingo());
                    } 
                    else if (msg.body === "Cozinha") {
                        msg.react('ğŸ‘');
                    }
                    else if (msg.body === "Quarto") {
                        msg.react('ğŸ‘');
                    }
                    else if (msg.body === "Quartos") {
                        msg.react('ğŸ‘');
                    }
                    else if (msg.body === "Banheiro") {
                        msg.react('ğŸ‘');
                    }
                    else if (msg.body === "Banheiros") {
                        msg.react('ğŸ‘');
                    }
                    else if (msg.body === "Lavanderia") {
                        msg.react('ğŸ‘');
                    }
                    else if (msg.body === "EscritÃ³rio") {
                        msg.react('ğŸ‘');
                    }
                    else if (msg.body === "Sala") {
                        msg.react('ğŸ‘');
                    }

                });
                
                
                

             

            

        
    

